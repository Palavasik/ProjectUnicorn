# Спецификация MVP: Project Unicorn Bot

Версия: 1.0  
Дата: 2025

## 1. Цель MVP

Помочь бегуну-любителю быстро найти подходящий маршрут для бега в незнакомом городе по критериям: город, дистанция, тип поверхности.

## 2. Сценарии использования

### 2.1 Основной сценарий: поиск маршрута

1. Пользователь отправляет `/find`
2. Бот показывает inline-кнопки с выбором города (Москва, Санкт-Петербург)
3. Пользователь выбирает город
4. Бот запрашивает дистанцию в км (текстовый ввод)
5. Пользователь вводит число (например: 10)
6. Бот показывает inline-кнопки с типом поверхности (Асфальт, Парк, Трейл, Набережная)
7. Пользователь выбирает тип
8. Бот выводит список подходящих маршрутов с описанием, покрытием, особенностями и ссылкой на карту

### 2.2 Отмена поиска

В любой момент диалога пользователь может отправить `/cancel` — поиск прерывается, состояние сбрасывается.

### 2.3 Неизвестная команда

При любом текстовом сообщении, не являющемся командой и не ожидаемым в контексте диалога, бот отвечает: «Не понимаю эту команду. Используйте /help для списка доступных команд.»

## 3. Команды

| Команда | Описание |
|---------|----------|
| `/start` | Приветствие и ценностное предложение продукта |
| `/help` | Список доступных команд |
| `/find` | Начать поиск маршрута |
| `/cancel` | Отменить текущий поиск |

## 4. Форматы данных

### 4.1 Маршрут (Route)

| Поле | Тип | Описание |
|------|-----|----------|
| id | string | Уникальный идентификатор |
| city | string | Город |
| name | string | Название маршрута |
| distance_km | number | Длина в км |
| surface_type | string | asphalt / park / trail / embankment |
| description | string | Краткое описание |
| features | array of string | Особенности (освещение, людность и т.д.) |
| map_link | string (optional) | URL карты (OpenStreetMap и т.п.) |

### 4.2 Файл данных

`data/routes.json` — массив объектов Route. Кодировка: UTF-8.

### 4.3 Логика поиска

- **Город:** точное совпадение
- **Дистанция:** допуск ±2 км от введённого значения
- **Тип поверхности:** точное совпадение

Результаты сортируются по близости к запрошенной дистанции.

## 5. Ограничения MVP

- **Локальный запуск:** бот работает через polling, без webhook
- **Mock-данные:** маршруты загружаются из JSON, без внешних API
- **Состояние:** хранится в памяти (`context.user_data`), сбрасывается при перезапуске бота
- **Города:** Москва, Санкт-Петербург (расширяемо через `routes.json`)
- **Валидация дистанции:** 1–50 км

## 6. Обработка ошибок

| Ситуация | Поведение |
|----------|-----------|
| Нечисловая дистанция | Повторный запрос с подсказкой |
| Дистанция вне 1–50 км | Повторный запрос |
| Маршруты не найдены | Сообщение «Маршруты не найдены. Попробуйте изменить параметры.» + предложение /find |
| Файл routes.json отсутствует | Пустой список маршрутов, логирование предупреждения |

## 7. Ссылки

- [Карточка продукта](../product/PRODUCT_CARD.md)
- [Архитектура](../architecture/README.md)
- [API документация](../api/README.md)
